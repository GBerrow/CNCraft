{% extends "base.html" %}
{% load static %}

{% block extra_title %}Update Account - {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profiles/dashboard.css' %}" />
{% endblock %}

{% block page_header %}
<div class="page-header-spacer"></div>
{% endblock %}

{% block content %}
<div class="dashboard-page-wrapper">
    <div class="container-fluid">
        <!-- Page Header -->
        <div class="dashboard-header">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-12 text-center">
                        <h1 class="dashboard-title">
                            <i class="fas fa-user-edit"></i>
                            Update Account Settings
                        </h1>
                        <p class="dashboard-subtitle">Change your email address and password</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container-fluid">
            <div class="dashboard-content-wrapper">
                <div class="row dashboard-content justify-content-center">
                    <div class="col-12 col-lg-8">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3><i class="fas fa-user"></i>Profile Information</h3>
                                <p>Update your personal and shipping information</p>
                            </div>
                            <div class="section-content">
                                <div class="profile-actions mb-3">
                                    <button
                                        type="button"
                                        class="btn btn-outline-black"
                                        data-bs-toggle="collapse"
                                        data-bs-target="#editProfile"
                                        id="editProfileBtn"
                                    >
                                        <i class="fas fa-edit"></i> Edit Profile
                                    </button>
                                </div>

                                <!-- Collapsible Edit Profile Form -->
                                <div class="collapse" id="editProfile">
                                    <div class="edit-form-container">
                                        <form action="{% url 'update_user' %}" method="POST" id="profile-update-form">
                                            {% csrf_token %}
                                            
                                            <!-- Email Address Section -->
                                            <div class="form-section mb-4">
                                                <h5 class="form-section-title">
                                                    <i class="fas fa-envelope"></i> Email Address
                                                </h5>
                                                <div class="row">
                                                    <div class="col-12 mb-3">
                                                        <label for="current_email" class="form-label">Current Email</label>
                                                        <input type="email" class="form-control" id="current_email" 
                                                               value="{{ current_email }}" readonly>
                                                    </div>
                                                    <div class="col-12 mb-3">
                                                        <label for="new_email" class="form-label">New Email Address</label>
                                                        <input type="email" class="form-control" id="new_email" name="new_email" 
                                                               autocomplete="email" placeholder="Enter new email address">
                                                    </div>
                                                    <div class="col-12 mb-3">
                                                        <label for="confirm_new_email" class="form-label">Confirm New Email</label>
                                                        <input type="email" class="form-control" id="confirm_new_email" name="confirm_new_email" 
                                                               autocomplete="email" placeholder="Confirm new email address">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Phone Number Section -->
                                            <div class="form-section mb-4">
                                                <h5 class="form-section-title">
                                                    <i class="fas fa-phone"></i> Phone Number
                                                </h5>
                                                <div class="row">
                                                    <div class="col-12 mb-3">
                                                        <label for="current_phone" class="form-label">Current Phone</label>
                                                        <input type="tel" class="form-control" id="current_phone" 
                                                               value="{{ form.instance.default_phone_number|default:'Not provided' }}" readonly>
                                                    </div>
                                                    <div class="col-12 mb-3">
                                                        <label for="new_phone" class="form-label">New Phone Number</label>
                                                        <input type="tel" class="form-control" id="new_phone" name="new_phone" 
                                                               autocomplete="tel" placeholder="Enter new phone number">
                                                    </div>
                                                    <div class="col-12 mb-3">
                                                        <label for="confirm_new_phone" class="form-label">Confirm New Phone</label>
                                                        <input type="tel" class="form-control" id="confirm_new_phone" name="confirm_new_phone" 
                                                               autocomplete="tel" placeholder="Confirm new phone number">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Shipping Address Section -->
                                            <div class="form-section mb-4">
                                                <h5 class="form-section-title">
                                                    <i class="fas fa-shipping-fast"></i> Shipping Address
                                                </h5>
                                                <div class="row">
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <label for="id_default_street_address1" class="form-label">Street Address 1</label>
                                                        {{ form.default_street_address1 }}
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <label for="id_default_street_address2" class="form-label">Street Address 2</label>
                                                        {{ form.default_street_address2 }}
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <label for="id_default_town_or_city" class="form-label">Town or City</label>
                                                        {{ form.default_town_or_city }}
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <label for="id_default_county" class="form-label">County, State or Locality</label>
                                                        {{ form.default_county }}
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <label for="id_default_postcode" class="form-label">Postal Code</label>
                                                        {{ form.default_postcode }}
                                                    </div>
                                                    <div class="col-12 col-md-6 mb-3">
                                                        <label for="id_default_country" class="form-label">Country</label>
                                                        {{ form.default_country }}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-black text-uppercase">
                                                <i class="fas fa-save"></i> Update Information
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-section mt-4">
                            <div class="section-header">
                                <h3><i class="fas fa-credit-card"></i>Payment Details</h3>
                                <p>Save your payment information for faster checkout</p>
                            </div>
                            <div class="section-content">
                                <div class="payment-security-notice">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>Security Notice:</strong> Payment details are for demonstration purposes only. 
                                    In a production environment, this would require HTTPS and secure payment processing.
                                </div>
                                <div class="payment-info-container">
                                    <form method="POST" class="payment-form">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="card_holder_name" class="form-label">Card Holder Name</label>
                                                <input type="text" class="form-control" id="card_holder_name" name="card_holder_name" 
                                                       placeholder="Name on card" disabled>
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <label for="card_number" class="form-label">Card Number</label>
                                                <input type="text" class="form-control" id="card_number" name="card_number" 
                                                       placeholder="1234 5678 9012 3456" maxlength="19" disabled>
                                            </div>
                                            <div class="col-12 col-md-4 mb-3">
                                                <label for="expiry_month" class="form-label">Expiry Month</label>
                                                <select class="form-control" id="expiry_month" name="expiry_month" disabled>
                                                    <option value="">Month</option>
                                                    <option value="01">01</option>
                                                    <option value="02">02</option>
                                                    <option value="03">03</option>
                                                    <option value="04">04</option>
                                                    <option value="05">05</option>
                                                    <option value="06">06</option>
                                                    <option value="07">07</option>
                                                    <option value="08">08</option>
                                                    <option value="09">09</option>
                                                    <option value="10">10</option>
                                                    <option value="11">11</option>
                                                    <option value="12">12</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-4 mb-3">
                                                <label for="expiry_year" class="form-label">Expiry Year</label>
                                                <select class="form-control" id="expiry_year" name="expiry_year" disabled>
                                                    <option value="">Year</option>
                                                    <option value="2025">2025</option>
                                                    <option value="2026">2026</option>
                                                    <option value="2027">2027</option>
                                                    <option value="2028">2028</option>
                                                    <option value="2029">2029</option>
                                                    <option value="2030">2030</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-4 mb-3">
                                                <label for="cvv" class="form-label">CVV</label>
                                                <input type="text" class="form-control" id="cvv" name="cvv" 
                                                       placeholder="123" maxlength="4" disabled>
                                            </div>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="save_payment" name="save_payment" disabled>
                                            <label class="form-check-label" for="save_payment">
                                                Save payment information for future purchases
                                            </label>
                                        </div>
                                        <button type="submit" class="btn btn-outline-info" disabled>
                                            <i class="fas fa-save"></i> Save Payment Details
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-section mt-4">
                            <div class="section-header">
                                <h3><i class="fas fa-key"></i>Change Password</h3>
                                <p>Update your account password for security</p>
                            </div>
                            <div class="section-content">
                                <form method="POST" class="password-form">
                                    {% csrf_token %}
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <label for="id_old_password" class="form-label">Current Password</label>
                                            <input type="password" class="form-control" id="id_old_password" name="old_password" required>
                                            {% if password_form.old_password.errors %}
                                                <div class="text-danger small">{{ password_form.old_password.errors.0 }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-12 mb-3">
                                            <label for="id_new_password1" class="form-label">New Password</label>
                                            <input type="password" class="form-control" id="id_new_password1" name="new_password1" required>
                                            {% if password_form.new_password1.errors %}
                                                <div class="text-danger small">{{ password_form.new_password1.errors.0 }}</div>
                                            {% endif %}
                                            <small class="form-text text-muted">
                                                Your password must contain at least 8 characters and cannot be too common.
                                            </small>
                                        </div>
                                        <div class="col-12 mb-3">
                                            <label for="id_new_password2" class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" id="id_new_password2" name="new_password2" required>
                                            {% if password_form.new_password2.errors %}
                                                <div class="text-danger small">{{ password_form.new_password2.errors.0 }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-outline-info">
                                        <i class="fas fa-key"></i> Change Password
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Back to Dashboard -->
                        <div class="text-center mt-4">
                            <a href="{% url 'profile' %}" class="btn btn-outline-black">
                                <i class="fas fa-arrow-left"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<script src="{% static 'javascript/profiles/dashboard.js' %}"></script>
<script type="text/javascript">
  $(document).ready(function() {
    // Add Bootstrap classes to password form fields
    $("#password-form input").addClass("form-control");
    $("#password-form input").addClass("border-2");
    
    // Real-time validation for email matching
    $('#new_email, #confirm_new_email').on('input', function() {
      const newEmail = $('#new_email').val();
      const confirmEmail = $('#confirm_new_email').val();
      
      if (confirmEmail && newEmail !== confirmEmail) {
        $('#confirm_new_email').addClass('is-invalid');
        if (!$('#email-error').length) {
          $('#confirm_new_email').after('<div id="email-error" class="invalid-feedback">Email addresses do not match</div>');
        }
      } else {
        $('#confirm_new_email').removeClass('is-invalid');
        $('#email-error').remove();
      }
    });
    
    // Real-time validation for phone matching
    $('#new_phone, #confirm_new_phone').on('input', function() {
      const newPhone = $('#new_phone').val();
      const confirmPhone = $('#confirm_new_phone').val();
      
      if (confirmPhone && newPhone !== confirmPhone) {
        $('#confirm_new_phone').addClass('is-invalid');
        if (!$('#phone-error').length) {
          $('#confirm_new_phone').after('<div id="phone-error" class="invalid-feedback">Phone numbers do not match</div>');
        }
      } else {
        $('#confirm_new_phone').removeClass('is-invalid');
        $('#phone-error').remove();
      }
    });
  });
</script>
{% endblock %} 